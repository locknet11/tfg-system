<div
  class="flex h-full align-items-center justify-content-center selector__layout">
  <div class="align-self-center w-full md:w-4 p-6 md:p-8 border-round auth-box">
    <form [formGroup]="selectorForm" (ngSubmit)="enterProject()">
      <div class="mb-5 text-center">
        <img
          src="../../../../assets/img/logo.png"
          alt="Logo"
          height="60"
          class="mb-4" />
        <div class="text-900 text-2xl font-medium mb-2" i18n>
          Select Organization & Project
        </div>
        <div class="text-600 text-sm" i18n>
          Choose an organization and project to continue.
        </div>
      </div>

      <div class="flex flex-column gap-4" *ngIf="!showNoOrganizationsMessage">
        <div>
          <label class="block text-900 font-medium mb-2" i18n
            >Organization</label
          >
          <p-dropdown
            formControlName="organization"
            [options]="organizationDropdownOptions"
            optionLabel="name"
            placeholder="Select an organization"
            [filter]="true"
            filterBy="name"
            [showClear]="true"
            styleClass="w-full"
            class="w-full"
            [disabled]="loading">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div class="flex align-items-center gap-2" *ngIf="selectedOption">
                <div>{{ selectedOption.name }}</div>
              </div>
            </ng-template>
            <ng-template let-option pTemplate="item">
              <div class="flex align-items-center gap-2">
                <i
                  class="pi pi-plus text-sm"
                  *ngIf="option?.isCreateOption"></i>
                <div>{{ option?.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div>
          <label class="block text-900 font-medium mb-2" i18n>Project</label>
          <p-dropdown
            formControlName="project"
            [options]="projectDropdownOptions"
            optionLabel="name"
            placeholder="Select a project"
            [filter]="true"
            filterBy="name"
            [showClear]="true"
            styleClass="w-full"
            class="w-full">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div class="flex align-items-center gap-2" *ngIf="selectedOption">
                <div>{{ selectedOption.name }}</div>
              </div>
            </ng-template>
            <ng-template let-option pTemplate="item">
              <div class="flex align-items-center gap-2">
                <i
                  class="pi pi-plus text-sm"
                  *ngIf="option?.isCreateOption"></i>
                <div>{{ option?.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <button
          [disabled]="selectorForm.invalid"
          i18n-label
          pButton
          label="Enter Project"
          pRipple
          icon="pi pi-arrow-right"
          class="w-full p-3 mt-2"></button>
      </div>

      <div *ngIf="showNoOrganizationsMessage && !loading">
        <div
          class="bg-gray-800 border-1 border-gray-600 border-round p-4 text-center">
          <i class="pi pi-info-circle text-blue-400 text-4xl mb-3 block"></i>
          <div class="text-gray-100 text-xl font-medium mb-3" i18n>
            Welcome! Let's get started
          </div>
          <div class="text-gray-300 text-base mb-4" i18n>
            You need to create your first organization and project to continue
            using the system.
          </div>
          <button
            pButton
            type="button"
            label="Get Started"
            i18n-label
            icon="pi pi-plus"
            severity="contrast"
            (click)="openSetupWizard()"></button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Create Organization Dialog -->
<p-dialog
  [(visible)]="showCreateOrganizationDialog"
  [modal]="true"
  header="Create Organization"
  i18n-header
  styleClass="w-full md:w-4">
  <form [formGroup]="createOrganizationForm">
    <div class="flex flex-column gap-4">
      <div>
        <label class="block text-900 font-medium mb-2" i18n>Name *</label>
        <input
          pInputText
          formControlName="name"
          placeholder="Enter organization name"
          i18n-placeholder
          class="w-full"
          [class.ng-invalid]="
            createOrganizationForm.get('name')?.invalid &&
            createOrganizationForm.get('name')?.touched
          " />
        <small
          class="text-red-500 mt-1"
          *ngIf="
            createOrganizationForm.get('name')?.invalid &&
            createOrganizationForm.get('name')?.touched
          "
          i18n>
          Organization name is required and must be at least 2 characters.
        </small>
      </div>

      <div>
        <label class="block text-900 font-medium mb-2" i18n>Description</label>
        <textarea
          pInputTextarea
          formControlName="description"
          placeholder="Enter organization description (optional)"
          i18n-placeholder
          rows="3"
          class="w-full">
        </textarea>
      </div>
    </div>
  </form>
  <ng-template pTemplate="footer">
    <div
      class="flex justify-content-end gap-2 p-3 border-top-1 border-gray-600">
      <button
        pButton
        type="button"
        label="Cancel"
        i18n-label
        icon="pi pi-times"
        class="p-button-text"
        (click)="closeCreateOrganizationDialog()"></button>
      <button
        pButton
        type="button"
        (click)="createOrganization()"
        label="Create Organization"
        i18n-label
        icon="pi pi-check"
        [disabled]="createOrganizationForm.invalid"
        class="p-button-primary"></button>
    </div>
  </ng-template>
</p-dialog>

<!-- Create Project Dialog -->
<p-dialog
  [(visible)]="showCreateProjectDialog"
  [modal]="true"
  header="Create Project"
  i18n-header
  styleClass="w-full md:w-4">
  <form [formGroup]="createProjectForm">
    <div class="flex flex-column gap-4">
      <div>
        <label class="block text-900 font-medium mb-2" i18n>Organization</label>
        <p-dropdown
          formControlName="organizationId"
          [options]="organizations"
          optionLabel="name"
          optionValue="id"
          [disabled]="true"
          styleClass="w-full"
          class="w-full">
        </p-dropdown>
      </div>

      <div>
        <label class="block text-900 font-medium mb-2" i18n>Name *</label>
        <input
          pInputText
          formControlName="name"
          placeholder="Enter project name"
          i18n-placeholder
          class="w-full"
          [class.ng-invalid]="
            createProjectForm.get('name')?.invalid &&
            createProjectForm.get('name')?.touched
          " />
        <small
          class="text-red-500 mt-1"
          *ngIf="
            createProjectForm.get('name')?.invalid &&
            createProjectForm.get('name')?.touched
          "
          i18n>
          Project name is required and must be at least 2 characters.
        </small>
      </div>

      <div>
        <label class="block text-900 font-medium mb-2" i18n>Description</label>
        <textarea
          pInputTextarea
          formControlName="description"
          placeholder="Enter project description (optional)"
          i18n-placeholder
          rows="3"
          class="w-full">
        </textarea>
      </div>
    </div>
  </form>
  <ng-template pTemplate="footer">
    <div
      class="flex justify-content-end gap-2 p-3 border-top-1 border-gray-600">
      <button
        pButton
        type="button"
        label="Cancel"
        i18n-label
        icon="pi pi-times"
        class="p-button-text"
        (click)="closeCreateProjectDialog()"></button>
      <button
        pButton
        type="button"
        (click)="createProject()"
        label="Create Project"
        i18n-label
        icon="pi pi-check"
        [disabled]="createProjectForm.invalid"
        class="p-button-primary"></button>
    </div>
  </ng-template>
</p-dialog>

<!-- Setup Wizard Dialog -->
<p-dialog
  [(visible)]="showSetupWizardDialog"
  [modal]="true"
  [closable]="false"
  [closeOnEscape]="false"
  header="Setup Your Workspace"
  i18n-header
  styleClass="w-full md:w-5">
  <div class="flex flex-column gap-4">
    <p-steps
      [model]="setupWizardItems"
      [(activeIndex)]="setupWizardActiveIndex"
      [readonly]="true"
      styleClass="w-full">
    </p-steps>

    <!-- Step 1: Create Organization -->
    <div *ngIf="setupWizardActiveIndex === 0" class="mt-4">
      <div class="text-center mb-4">
        <i class="pi pi-building text-4xl text-primary mb-3 block"></i>
        <h3 class="text-900 mb-2" i18n>Create Your Organization</h3>
        <p class="text-600 text-sm" i18n>
          Start by creating your organization. This will be the main container
          for your projects.
        </p>
      </div>

      <form [formGroup]="createOrganizationForm">
        <div class="flex flex-column gap-4">
          <div>
            <label class="block text-900 font-medium mb-2" i18n>Name *</label>
            <input
              pInputText
              formControlName="name"
              placeholder="Enter organization name"
              i18n-placeholder
              class="w-full"
              [class.ng-invalid]="
                createOrganizationForm.get('name')?.invalid &&
                createOrganizationForm.get('name')?.touched
              " />
            <small
              class="text-red-500 mt-1"
              *ngIf="
                createOrganizationForm.get('name')?.invalid &&
                createOrganizationForm.get('name')?.touched
              "
              i18n>
              Organization name is required and must be at least 2 characters.
            </small>
          </div>

          <div>
            <label class="block text-900 font-medium mb-2" i18n
              >Description</label
            >
            <textarea
              pInputTextarea
              formControlName="description"
              placeholder="Enter organization description (optional)"
              i18n-placeholder
              rows="3"
              class="w-full">
            </textarea>
          </div>
        </div>
      </form>
    </div>

    <!-- Step 2: Create Project -->
    <div *ngIf="setupWizardActiveIndex === 1" class="mt-4">
      <div class="text-center mb-4">
        <i class="pi pi-folder text-4xl text-primary mb-3 block"></i>
        <h3 class="text-900 mb-2" i18n>Create Your First Project</h3>
        <p class="text-600 text-sm" i18n>
          Now create your first project within the organization you just
          created.
        </p>
      </div>

      <form [formGroup]="createProjectForm">
        <div class="flex flex-column gap-4">
          <div>
            <label class="block text-900 font-medium mb-2" i18n
              >Organization</label
            >
            <p-dropdown
              formControlName="organizationId"
              [options]="organizations"
              optionLabel="name"
              optionValue="id"
              [disabled]="true"
              styleClass="w-full"
              class="w-full">
            </p-dropdown>
          </div>

          <div>
            <label class="block text-900 font-medium mb-2" i18n>Name *</label>
            <input
              pInputText
              formControlName="name"
              placeholder="Enter project name"
              i18n-placeholder
              class="w-full"
              [class.ng-invalid]="
                createProjectForm.get('name')?.invalid &&
                createProjectForm.get('name')?.touched
              " />
            <small
              class="text-red-500 mt-1"
              *ngIf="
                createProjectForm.get('name')?.invalid &&
                createProjectForm.get('name')?.touched
              "
              i18n>
              Project name is required and must be at least 2 characters.
            </small>
          </div>

          <div>
            <label class="block text-900 font-medium mb-2" i18n
              >Description</label
            >
            <textarea
              pInputTextarea
              formControlName="description"
              placeholder="Enter project description (optional)"
              i18n-placeholder
              rows="3"
              class="w-full">
            </textarea>
          </div>
        </div>
      </form>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div
      class="flex justify-content-between w-full gap-2 p-3 bg-gray-800 border-top-1 border-gray-600">
      <button
        pButton
        type="button"
        label="Previous"
        i18n-label
        icon="pi pi-arrow-left"
        class="p-button-secondary"
        [disabled]="setupWizardActiveIndex === 0"
        (click)="previousStep()"></button>

      <div class="flex gap-2">
        <button
          pButton
          type="button"
          label="Cancel"
          i18n-label
          icon="pi pi-times"
          class="p-button-text"
          (click)="closeSetupWizard()"></button>

        <button
          *ngIf="setupWizardActiveIndex === 0"
          pButton
          type="button"
          label="Next"
          i18n-label
          icon="pi pi-arrow-right"
          class="p-button-primary"
          [disabled]="createOrganizationForm.invalid"
          (click)="nextStep()"></button>

        <button
          *ngIf="setupWizardActiveIndex === 1"
          pButton
          type="button"
          label="Complete Setup"
          i18n-label
          icon="pi pi-check"
          class="p-button-primary"
          [disabled]="createProjectForm.invalid"
          (click)="createProjectInWizard()"></button>
      </div>
    </div>
  </ng-template>
</p-dialog>
